"use strict";(self.webpackChunkaptos_docs=self.webpackChunkaptos_docs||[]).push([[3828],{85040:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>r,contentTitle:()=>a,default:()=>p,frontMatter:()=>c,metadata:()=>i,toc:()=>d});var t=n(63159),o=n(83581);const c={title:"Move Scripts Tutorial"},a="Move Scripts",i={id:"move/move-on-aptos/scripts/script-tutorial",title:"Move Scripts Tutorial",description:"This tutorial explains how to write and execute a Move script. You can use Move scripts to execute a series of commands across published Move module interfaces.",source:"@site/i18n/ja/docusaurus-plugin-content-docs/current/move/move-on-aptos/scripts/script-tutorial.md",sourceDirName:"move/move-on-aptos/scripts",slug:"/move/move-on-aptos/scripts/script-tutorial",permalink:"/move/move-on-aptos/scripts/script-tutorial",draft:!1,unlisted:!1,editUrl:"https://github.com/aptos-labs/developer-docs/edit/main/apps/docusaurus/docs/move/move-on-aptos/scripts/script-tutorial.md",tags:[],version:"current",lastUpdatedAt:1713276994,formattedLastUpdatedAt:"2024\u5e744\u670816\u65e5",frontMatter:{title:"Move Scripts Tutorial"},sidebar:"appSidebar",previous:{title:"Running Move Scripts",permalink:"/move/move-on-aptos/scripts/running-scripts"},next:{title:"Resource Accounts",permalink:"/move/move-on-aptos/resource-accounts"}},r={},d=[{value:"Example use case",id:"example-use-case",level:2},{value:"Execution",id:"execution",level:2},{value:"Advanced",id:"advanced",level:2}];function l(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"move-scripts",children:"Move Scripts"}),"\n",(0,t.jsxs)(s.p,{children:["This tutorial explains how to write and execute a ",(0,t.jsx)(s.a,{href:"/move/book/modules-and-scripts",children:"Move script"}),". You can use Move scripts to execute a series of commands across published Move module interfaces."]}),"\n",(0,t.jsxs)(s.p,{children:["For more information about scripts, see the ",(0,t.jsx)(s.a,{href:"/move/move-on-aptos/scripts/",children:"Move scripts docs"})]}),"\n",(0,t.jsx)(s.h2,{id:"example-use-case",children:"Example use case"}),"\n",(0,t.jsxs)(s.p,{children:["The following example calls functions on the ",(0,t.jsx)(s.a,{href:"https://github.com/aptos-labs/aptos-core/blob/main/aptos-move/framework/aptos-framework/sources/aptos_coin.move",children:"aptos_coin.move"})," module to confirm the balance of the destination account is less than ",(0,t.jsx)(s.code,{children:"desired_balance"}),", and if so, tops it up to ",(0,t.jsx)(s.code,{children:"desired_balance"}),"."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-move",children:"script {\n    use std::signer;\n    use aptos_framework::aptos_account;\n    use aptos_framework::aptos_coin;\n    use aptos_framework::coin;\n\n    fun main(src: &signer, dest: address, desired_balance: u64) {\n        let src_addr = signer::address_of(src);\n\n        addr::my_module::do_nothing();\n\n        let balance = coin::balance<aptos_coin::AptosCoin>(src_addr);\n        if (balance < desired_balance) {\n            aptos_account::transfer(src, dest, desired_balance - balance);\n        };\n    }\n}\n"})}),"\n",(0,t.jsx)(s.h2,{id:"execution",children:"Execution"}),"\n",(0,t.jsx)(s.p,{children:"Now that you know what you would like to accomplish, you need to determine:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Where do I put these files?"}),"\n",(0,t.jsx)(s.li,{children:"What do I name them?"}),"\n",(0,t.jsxs)(s.li,{children:["Do I need a ",(0,t.jsx)(s.code,{children:"Move.toml"}),"?"]}),"\n",(0,t.jsx)(s.li,{children:"How do I run my script with the CLI?"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Let us run through how to execute a Move script with a step-by-step example using the ",(0,t.jsx)(s.a,{href:"/tools/aptos-cli/use-cli/use-aptos-cli",children:"Aptos CLI"}),"."]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Make a new directory for your work:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"mkdir testing\ncd testing\n"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Set up the Aptos CLI and ",(0,t.jsx)(s.a,{href:"/tools/aptos-cli/use-cli/use-aptos-cli#use-the-aptos-cli",children:"create an account"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"aptos init --network devnet\n"})}),"\n",(0,t.jsxs)(s.p,{children:["You may reuse an existing private key (which looks like this: ",(0,t.jsx)(s.code,{children:"0xbd944102bf5b5dfafa7fe865d8fa719da6a1f0eafa3cd600f93385482d2c37a4"}),"), or it can generate a new one for you, as part of setting up your account. Let's say your account looks like the example below:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:'---\nprofiles:\n  default:\n    private_key: "0xbd944102bf5b5dfafa7fe865d8fa719da6a1f0eafa3cd600f93385482d2c37a4"\n    public_key: "0x47673ec83bb254cc9a8bfdb31846daacd0c96fe41f81855462f5fc5306312b1b"\n    account: cb265645385819f3dbe71aac266e319e7f77aed252cacf2930b68102828bf615\n    rest_url: "https://api.devnet.aptoslabs.com"\n    faucet_url: "https://faucet.devnet.aptoslabs.com"\n'})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"From this same directory, initialize a new Move project:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"aptos move init --name run_script\n"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Create a ",(0,t.jsx)(s.code,{children:"my_script.move"})," file containing the example script above in a ",(0,t.jsx)(s.code,{children:"sources/"})," subdirectory of your ",(0,t.jsx)(s.code,{children:"testing/"})," directory. Also, create a ",(0,t.jsx)(s.code,{children:"my_module.move"})," file as seen in the example below:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"module addr::my_module {\n    public entry fun do_nothing() { }\n}\n"})}),"\n",(0,t.jsx)(s.p,{children:"This results in the following file structure:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"testing/\n   Move.toml\n   sources/\n      my_script.move\n      my_module.move\n"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Compile the script:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'$ aptos move compile --named-addresses addr=cb265645385819f3dbe71aac266e319e7f77aed252cacf2930b68102828bf615\nCompiling, may take a little while to download git dependencies...\nINCLUDING DEPENDENCY AptosFramework\nINCLUDING DEPENDENCY AptosStdlib\nINCLUDING DEPENDENCY MoveStdlib\nBUILDING run_script\n{\n  "Result": [\n    "cb265645385819f3dbe71aac266e319e7f77aed252cacf2930b68102828bf615::my_module"\n  ]\n}\n'})}),"\n",(0,t.jsxs)(s.p,{children:["Note how we use the ",(0,t.jsx)(s.code,{children:"--named-addresses"})," argument. This is necessary because in the code we refer to this named address called ",(0,t.jsx)(s.code,{children:"addr"}),". The compiler needs to know what this refers to. Instead of using this CLI argument, you could put something like this in your ",(0,t.jsx)(s.code,{children:"Move.toml"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'[addresses]\naddr = "cb265645385819f3dbe71aac266e319e7f77aed252cacf2930b68102828bf615"\n'})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Run the compiled script:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'$ aptos move run-script --compiled-script-path build/my_script/bytecode_scripts/main.mv --args address:b078d693856a65401d492f99ca0d6a29a0c5c0e371bc2521570a86e40d95f823 --args u64:5\nDo you want to submit a transaction for a range of [17000 - 25500] Octas at a gas unit price of 100 Octas? [yes/no] >\nyes\n{\n  "Result": {\n    "transaction_hash": "0xa6ca6275c73f82638b88a830015ab81734a533aebd36cc4647b48ff342434cdf",\n    "gas_used": 3,\n    "gas_unit_price": 100,\n    "sender": "cb265645385819f3dbe71aac266e319e7f77aed252cacf2930b68102828bf615",\n    "sequence_number": 4,\n    "success": true,\n    "timestamp_us": 1683030933803632,\n    "version": 3347495,\n    "vm_status": "Executed successfully"\n  }\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Note that the path of the compiled script is under ",(0,t.jsx)(s.code,{children:"build/run_script/"}),", not ",(0,t.jsx)(s.code,{children:"build/my_script/"}),". This is because it uses the name of the project contained in ",(0,t.jsx)(s.code,{children:"Move.toml"}),", which is ",(0,t.jsx)(s.code,{children:"run_script"})," from when we ran ",(0,t.jsx)(s.code,{children:"aptos move init --name run_script"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:["See the ",(0,t.jsx)(s.a,{href:"https://github.com/banool/move-examples/tree/main/run_script",children:"code"})," used for this document. The full example explains how to use a Move script that relies on a user-created Move module as well."]}),"\n",(0,t.jsxs)(s.p,{children:["See also how to do this with the ",(0,t.jsx)(s.a,{href:"https://github.com/aptos-labs/aptos-developer-discussions/discussions/24",children:"Rust SDK"})," instead of the Aptos CLI in Aptos Developer Discussions."]}),"\n",(0,t.jsx)(s.h2,{id:"advanced",children:"Advanced"}),"\n",(0,t.jsxs)(s.p,{children:["You may execute a script in a more streamlined fashion; instead of running ",(0,t.jsx)(s.code,{children:"aptos move compile"})," and then ",(0,t.jsx)(s.code,{children:"aptos move run-script --compiled-script-path"})," separately, you can just do this:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"$ aptos move run-script --script-path sources/my_script.move --args address:b078d693856a65401d492f99ca0d6a29a0c5c0e371bc2521570a86e40d95f823 --args u64:5\n"})}),"\n",(0,t.jsxs)(s.p,{children:["This will conduct both steps with a single CLI command yet has ",(0,t.jsx)(s.a,{href:"https://github.com/aptos-labs/aptos-core/issues/5733",children:"issues"}),". For this reason, we recommend using the previous two-step approach for now."]})]})}function p(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},83581:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>i});var t=n(11855);const o={},c=t.createContext(o);function a(e){const s=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),t.createElement(c.Provider,{value:s},e.children)}}}]);